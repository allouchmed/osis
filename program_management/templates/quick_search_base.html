{% load static i18n %}
{% load bootstrap3 %}


<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <h4 class="modal-title">{% trans "Search" %}</h4>
</div>

<div class="modal-body">
    <div id="message_info_modal" class="alert alert-danger" role="alert" style="visibility: hidden; display: none;"></div>

    {% block navbar %}


    {% endblock navbar %}

    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active">
            <form method="get" id="form-modal" action="{{ request.path }}" class="stay_in_modal">
                <input type="hidden" name="page" value="{{ page_obj.number }}">
                <div class="row">
                    {% block form_field %}


                    {% endblock form_field %}
                    <div class="col-md-2">
                        <button type="button" onclick="$('#form-modal').submit();" class="btn btn-primary" name="search-eg" title="search">
                            <em class="fa fa-search"></em>
                        </button>
                    </div>
                </div>
            </form>

            <div class="row">
                <div class="cold-md-3 pull-right">
                    <button class="btn btn-primary" id="button-attach">{% trans 'Attach' %}</button>
                </div>
            </div>
            {% if paginator.count %}
                <strong style="margin-left:10px;color:grey;">
                    {% blocktrans with start_index=page_obj.start_index end_index=page_obj.end_index total_counts=paginator.count %}{{ start_index }} to {{ end_index }} of {{ total_counts }} learning units{% endblocktrans %}
                </strong>
                <table id="table-objects" class="table table-striped table-responsive" style="width: 100%;">
                    <thead>
                    <tr>
                        {% block table_header %}


                        {% endblock table_header %}
                    </tr>
                    </thead>
                </table>
                <div style="text-align:center" id="search-pagination">
                    {% bootstrap_pagination page_obj extra=request.GET.urlencode %}
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% block script %}
    {# Define column_def variable in js and also quick_search_url #}
<script src="{% static "js/osis_datatable.js" %}"></script>
<script>
    $(document).ready(function()
    {
        document.getElementById("modal_dialog_id").classList.add("modal-lg");

        initializeDataTable("form-modal", "table-objects", "objectQuickSearchIds", {{ page_obj.number }},
            {{ paginator.per_page }}, "{{ quick_search_url }}", columnDefs);

        let checkUrl = "{% url 'check_education_group_attach' root_id education_group_year_id %}";
        let attachUrl = "{% url "education_group_attach" root_id education_group_year_id %}";
        $("#button-attach").click(attachModal(checkUrl, attachUrl));
        $("#search-pagination li a[href]").each(function(index, element){
            element.removeAttribute("href");
            const page = element.innerText;
            element.addEventListener('click', function(e){
                submit_with_page(page);
            });
        });
        bind_trigger_modal();
    });
</script>
{% endblock script %}

