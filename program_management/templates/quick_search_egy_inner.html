{% load static i18n %}
{% load bootstrap3 %}
{% url 'quick_search_education_group_serializer' root_id education_group_year_id as quick_search_url %}

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <h4 class="modal-title">{% trans "Search" %}</h4>
</div>

<div class="modal-body">
    <div id="message_info_modal" class="alert alert-danger" role="alert" style="visibility: hidden; display: none;"></div>

    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#">{% trans 'Trainings' %}</a></li>
        <li role="presentation">
            <a href="#" class="trigger_modal" data-url="{% url "quick_search_learning_unit" root_id education_group_year_id %}">{% trans 'Learning units' %}</a>
        </li>
    </ul>

    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active">
            <form method="get" id="form-modal" action="{{ request.path }}" class="stay_in_modal">
                <input type="hidden" name="page" value="{{ page_obj.number }}">
                <div class="row">
                    {% bootstrap_field form.academic_year form_group_class="hidden" %}
                    {% bootstrap_field form.acronym form_group_class="col-md-3" %}
                    {% bootstrap_field form.title form_group_class="col-md-6" %}
                    <div class="col-md-2">
                        <button type="button" onclick="$('#form-modal').submit();" class="btn btn-primary" name="search-eg" title="search">
                            <em class="fa fa-search"></em>
                        </button>
                    </div>
                </div>
            </form>

            <div class="row">
                <div class="cold-md-3 pull-right">
                    <button class="btn btn-primary" id="button-attach-eg">{% trans 'Attach' %}</button>
                </div>
            </div>

            <table id="table-education-group" class="table table-striped table-responsive" style="width: 100%;">
                <thead>
                <tr>
                    <th id="th_0_temp"></th>
                    <th id="th_1_academic_year">{% trans 'Ac yr.' %}</th>
                    <th id="th_2_acronym">{% trans 'Acronym/Short title' %}</th>
                    <th id="th_3_title">{% trans 'Title' %}</th>
                </tr>
                </thead>
            </table>

            <div class="text-center">
                <ul class="pagination">
                    {% if page_obj.has_previous %}
                        <li><a href="#" onclick="submit_with_page('{{ page_obj.previous_page_number }}')">&laquo;</a>
                        </li>
                    {% else %}
                        <li class="disabled"><span>&laquo;</span></li>
                    {% endif %}
                    {% for i in page_obj.paginator.page_range %}
                        {% if i <= page_obj.number|add:5 and i >= page_obj.number|add:-5 %}

                            {% if page_obj.number == i %}
                                <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                            {% else %}
                                <li><a href="#" onclick="submit_with_page('{{ i }}')">{{ i }}</a></li>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <li><a href="#" onclick="submit_with_page('{{ page_obj.next_page_number }}')">&raquo;</a></li>
                    {% else %}
                        <li class="disabled"><span>&raquo;</span></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</div>

<script src="{% static "js/osis_datatable.js" %}"></script>
<script>
    $(document).ready(function()
    {
        document.getElementById("modal_dialog_id").classList.add("modal-lg");
        columnDefs = [
            {
                "name": "temp",
                "targets": 0,
                "data": "acronym",
                "orderable": false,
                "render": function(data, type, row, meta) {
                    let input = document.createElement("input");
                    input.type = 'radio';
                    input.name = 'selected-item';
                    input.value = data;
                    input.setAttribute('data-url', row['url']);
                    input.setAttribute('data-name', `${row['academic_year']} - ${row['acronym']}`);
                    return input.outerHTML;
                }
            },
            {
                "name": "academic_year",
                "targets": 1,
                "data": "academic_year"
            },
            {
                "name": "acronym",
                "targets": 2,
                "data": "acronym",
                "render": function ( data, type, row, meta ) {
                    return '<a href="'+ row['osis_url'] +'">'+ data + '</a>';
                }
            },
            { "name": "title", "targets": 3, "data": "title"},
        ];
        let $table = initializeDataTable("form-modal", "table-education-group", "educationGroupsLightIds", 1,
            10, "{{ quick_search_url }}", columnDefs);
        $table.on('draw', onDraw);


        let root_id = "{{ root_id }}";
        let education_group_year_id = "{{ education_group_year_id }}";
        let url = `/program_management/${root_id}/${education_group_year_id}/content/attach/`;
        $("#button-attach-eg").click(attachModal(url));

        bind_trigger_modal();
    });
</script>

