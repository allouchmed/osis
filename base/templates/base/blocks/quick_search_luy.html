{% load static i18n %}
{% load bootstrap3 %}

{% url 'quick_search_learning_unit' as quick_search_lu %}

<form method="get" id="form-lu-quick-search">
    <input type="hidden" name="page" value="{{ page_obj.number }}">
    <div class="row">
        {% bootstrap_field lu_form.academic_year form_group_class="col-md-2" %}
        {% bootstrap_field lu_form.acronym form_group_class="col-md-2" %}
        {% bootstrap_field lu_form.title form_group_class="col-md-6" %}
        <div class="col-md-2">
            <button type="button" onclick="reloadLearningUnitSearchResult();" class="btn btn-primary" name="search-lu" title="search">
                <em class="fa fa-search"></em>
            </button>
        </div>
    </div>
</form>

<div class="row">
    <div class="cold-md-3 pull-right">
        <button class="btn btn-primary" id="button-attach-lu">{% trans 'Attach' %}</button>
    </div>
</div>

<table id="table-learning-unit" class="table table-striped table-responsive" style="width: 100%;">
    <thead>
    <tr>
        <th id="th_0_temp"></th>
        <th id="th_1_academic_year">{% trans 'Ac yr.' %}</th>
        <th id="th_2_acronym">{% trans 'Code' %}</th>
        <th id="th_3_title">{% trans 'Title' %}</th>
    </tr>
    </thead>
</table>

<div class="text-center">
    <ul class="pagination">
        {% if page_obj.has_previous %}
            <li><a href="#" onclick="submit_with_page('{{ page_obj.previous_page_number }}')">&laquo;</a>
            </li>
        {% else %}
            <li class="disabled"><span>&laquo;</span></li>
        {% endif %}
        {% for i in page_obj.paginator.page_range %}
            {% if i <= page_obj.number|add:5 and i >= page_obj.number|add:-5 %}
                {% if page_obj.number == i %}
                    <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                {% else %}
                    <li><a href="#" onclick="submit_with_page('{{ i }}')">{{ i }}</a></li>
                {% endif %}
            {% endif %}
        {% endfor %}
        {% if page_obj.has_next %}
            <li><a href="#" onclick="submit_with_page('{{ page_obj.next_page_number }}')">&raquo;</a></li>
        {% else %}
            <li class="disabled"><span>&raquo;</span></li>
        {% endif %}
    </ul>
</div>

<script src="{% static "js/osis_datatable.js" %}"></script>
<script>
    $(document).ready(function()
    {
        columnDefs = [
            {
                "name": "temp",
                "targets": 0,
                "data": "acronym",
                "orderable": false,
                "render": function(data, type, row, meta) {
                    let input = document.createElement("input");
                    input.type = 'radio';
                    input.name = 'selected-item';
                    input.value = data;
                    input.setAttribute('data-url', row['osis_url']);
                    input.setAttribute('data-name', `${row['academic_year']} - ${row['acronym']}`);
                    return input.outerHTML;
                }
            },
            {
                "name": "academic_year",
                "targets": 1,
                "data": "academic_year"
            },
            {
                "name": "acronym",
                "targets": 2,
                "data": "acronym",
                "render": function ( data, type, row, meta ) {
                    return '<a href="'+ row['osis_url'] +'">'+ data + '</a>';
                }
            },
            { "name": "title", "targets": 3, "data": "title"},
        ];
        let $table = initializeDataTable("form-lu-quick-search", "table-learning-unit", "learningUnitsLightIds", 1,
            10, "{{ quick_search_lu }}", columnDefs);
        $table.on('draw', onDraw);


        let root = "{{ root }}";
        let education_group_year = "{{ education_group_year }}";
        let url = `/program_management/${root}/${education_group_year}/content/attach/`;
        $("#button-attach-lu").click(attachModal(url));
    });
</script>
