{% load bootstrap3 i18n %}

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <h4 class="modal-title">{% trans "Search" %}</h4>
</div>
<div class="modal-body">
    <div id="message_info_modal" class="alert alert-info" role="alert" style="visibility: hidden; display: none;"></div>

    <ul class="nav nav-tabs" role="tablist">
        {% url 'quick_search_education_group' as quick_search_eg %}
        <li {% if request.path == quick_search_eg %} class="active" {% endif %}>
            <a href="#eg_search" role="tab" data-toggle="tab">
                {% trans 'Trainings' %}
            </a>
        </li>
        {% url 'quick_search_learning_unit' as quick_search_lu %}
        <li {% if request.path == quick_search_lu %} class="active" {% endif %}>
            <a href="#lu_search" role="tab" data-toggle="tab">
                {% trans 'Learning units' %}
            </a>
        </li>
    </ul>
    <br>
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane {% if request.path == quick_search_eg %}active{% endif %}" id="eg_search">
            <form method="get" id="form-modal-eg-search" action="{{ quick_search_eg }}" class="stay_in_modal">
                <input type="hidden" name="page" value="{{ page_obj.number }}">
                <div class="row">
                    {% bootstrap_field eg_form.acronym form_group_class="col-md-3" %}
                    {% bootstrap_field eg_form.title form_group_class="col-md-6" %}
                    <br>
                    <div class="col-md-2">
                        <button type="button" onclick="$('#form-modal-eg-search').submit();" class="btn btn-primary"
                                name="search" title="search">
                            <em class="fa fa-search"></em>
                        </button>
                    </div>
                </div>
            </form>
            <br>
            <table class="table table-striped table-responsive">
                <tbody>
                {% for object in eg_object_list %}
                    <tr>
                        <td>
                            <button onclick="select('{% url "education_group_select" object.pk object.pk %}',{'element_id': {{ object.pk }}})">
                                <i class="fas fa-file-import"></i>
                            </button>
                        </td>
                        <td><a href="{{ object.get_absolute_url }}">{{ object.acronym }}</a></td>
                        <td>{{ object.complete_title }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <div class="text-center">
                <ul class="pagination">
                    {% if page_obj.has_previous %}
                        <li><a href="#" onclick="submit_with_page('{{ page_obj.previous_page_number }}')">&laquo;</a>
                        </li>
                    {% else %}
                        <li class="disabled"><span>&laquo;</span></li>
                    {% endif %}
                    {% for i in page_obj.paginator.page_range %}
                        {% if i <= page_obj.number|add:5 and i >= page_obj.number|add:-5 %}

                            {% if page_obj.number == i %}
                                <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                            {% else %}
                                <li><a href="#" onclick="submit_with_page('{{ i }}')">{{ i }}</a></li>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <li><a href="#" onclick="submit_with_page('{{ page_obj.next_page_number }}')">&raquo;</a></li>
                    {% else %}
                        <li class="disabled"><span>&raquo;</span></li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <div role="tabpanel" class="tab-pane {% if request.path == quick_search_lu %}active{% endif %}" id="lu_search">
            <form method="get" id="form-modal-lu-search" action="{{ quick_search_lu }}" class="stay_in_modal">
                <input type="hidden" name="page" value="{{ page_obj.number }}">
                <div class="row">
                    {% bootstrap_field lu_form.academic_year form_group_class="col-md-2" %}
                    {% bootstrap_field lu_form.acronym form_group_class="col-md-2" %}
                    {% bootstrap_field lu_form.title form_group_class="col-md-6" %}
                    <br>
                    <div class="col-md-2">
                        <button type="button" onclick="$('#form-modal-lu-search').submit();" class="btn btn-primary"
                                name="search" title="search">
                            <em class="fa fa-search"></em>
                        </button>
                    </div>
                </div>
            </form>
            <br>
            <table class="table table-striped table-responsive">
                <tbody>
                {% for object in lu_object_list %}
                    <tr>
                        <td>
                            <button onclick="select('{% url "learning_unit_select" object.pk %}')">
                                <i class="fas fa-file-import"></i>
                            </button>
                        </td>
                        <td><a href="{{ object.get_absolute_url }}">{{ object.acronym }}</a></td>
                        <td>{{ object.complete_title }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <div class="text-center">
                <ul class="pagination">
                    {% if page_obj.has_previous %}
                        <li><a href="#" onclick="submit_with_page('{{ page_obj.previous_page_number }}')">&laquo;</a>
                        </li>
                    {% else %}
                        <li class="disabled"><span>&laquo;</span></li>
                    {% endif %}
                    {% for i in page_obj.paginator.page_range %}
                        {% if i <= page_obj.number|add:5 and i >= page_obj.number|add:-5 %}

                            {% if page_obj.number == i %}
                                <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                            {% else %}
                                <li><a href="#" onclick="submit_with_page('{{ i }}')">{{ i }}</a></li>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <li><a href="#" onclick="submit_with_page('{{ page_obj.next_page_number }}')">&raquo;</a></li>
                    {% else %}
                        <li class="disabled"><span>&raquo;</span></li>
                    {% endif %}
                </ul>
            </div>
        </div>
</div>

<script>
    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      bind_trigger_modal();
    });

    function submit_with_page(page) {
        $("input[name='page']").val(page);
        $('#form-modal-eg-search').submit();
    }

    function select(url_select, data) {
        $.ajax({
            url: url_select,
            dataType: 'json',
            type: 'POST',
            data: data,
            success: function (jsonResponse) {
                displayInfoMessage(jsonResponse, 'clipboard');
            }
        });
    }
</script>