{% load staticfiles bootstrap3 %}
{% load i18n %}

{% comment "License" %}
    * OSIS stands for Open Student Information System. It's an application
    * designed to manage the core business of higher education institutions,
    * such as universities, faculties, institutes and professional schools.
    * The core business involves the administration of students, teachers,
    * courses, programs and so on.
    *
    * Copyright (C) 2015-2019 Universit√© catholique de Louvain (http://www.uclouvain.be)
    *
    * This program is free software: you can redistribute it and/or modify
    * it under the terms of the GNU General Public License as published by
    * the Free Software Foundation, either version 3 of the License, or
    * (at your option) any later version.
    *
    * This program is distributed in the hope that it will be useful,
    * but WITHOUT ANY WARRANTY; without even the implied warranty of
    * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    * GNU General Public License for more details.
    *
    * A copy of this license - GNU General Public License - is available
    * at the root of the source code of this program.  If not,
    * see http://www.gnu.org/licenses/.
{% endcomment %}
{% bootstrap_form_errors form_education_group_year %}
{% bootstrap_form_errors form_education_group %}
<form method="post" id="UpdateTrainingForm"
      class="education_group_form"
      data-validate-url="



              {% if education_group_year %}{% url 'validate_education_group_field' form_education_group_year.category education_group_year.pk %} {% else %}{% url 'validate_education_group_field' form_education_group_year.category %}{% endif %}">
    {% csrf_token %}
    <div class="panel panel-default">

        <div class="panel-heading">
            {% include "education_group/blocks/form/create_cancel_buttons.html" with btn_submit_name="btn_submit_UpdateTrainingForm" %}
        </div>

        <div class="panel-body">
            {% include "education_group/blocks/form/training_tab_identification.html" %}
        </div>

        <div class="panel-footer text-right">
            {% include "education_group/blocks/form/create_cancel_buttons.html" with btn_submit_name="btn_submit_UpdateTrainingForm" %}
        </div>

    </div>
    <script type="text/javascript" src="{% static 'js/education_group/validation.js' %}"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('button[name="btn_submit_UpdateTrainingForm"]').click(function (e) {
                $("#spn_identification_errors").empty();
                $("#spn_diploma_errors").empty();
            });

            var form = document.getElementById("UpdateTrainingForm");

            form.addEventListener('invalid', (e) => {
                var el = e.target;
                while (el && el.parentNode) {
                    el = el.parentNode;
                    let element = document.getElementById(e.target.id);
                    if (! element.parentElement.getAttribute('class').includes('has-error')) {
                        element.style.borderColor = '#e52213';
                        element.parentElement.setAttribute('class', 'form-group required_field has-error');
                        let error_msg = document.createElement("div");
                        error_msg.setAttribute('class', 'help-block');
                        let newContent = document.createTextNode(gettext("Field is required"));
                        error_msg.appendChild(newContent);
                        element.parentElement.append(error_msg);
                    }
                    if (el.parentNode.id == "tab_identification") {
                        $("#spn_identification_errors").append('<i class="fa fa-circle" aria-hidden="true"></i>');
                        return false;
                    }
                    if (el.parentNode.id == "div_tab_diploma") {
                        $("#spn_diploma_errors").append('<i class="fa fa-circle" aria-hidden="true"></i>');
                        return false;
                    }

                }

            }, true);
            let tab_identification = document.getElementById('tab_identification');
            let tab_diploma = document.getElementById('tab_diploma');

            if (tab_identification.getElementsByClassName('has-error').length > 0)
                $("#spn_identification_errors").append('<i class="fa fa-circle" aria-hidden="true"></i>');
            if (tab_diploma.getElementsByClassName('has-error').length > 0)
                $("#spn_diploma_errors").append('<i class="fa fa-circle" aria-hidden="true"></i>');
        });

    </script>
    {% include "blocks/modal/confirmation_modal.html" %}
</form>
